- name: D√©charger le module {{ mod_name }} s‚Äôil est charg√©
  shell: |
    modprobe -r {{ mod_name }} 2>/dev/null || true
    rmmod {{ mod_name }} 2>/dev/null || true
  ignore_errors: true

- name: Ajouter la directive 'install /bin/false' si absente
  lineinfile:
    path: "{{ mod_conf_file }}"
    line: "install {{ mod_name }} {{ '/bin/false' | realpath }}"
    create: true
  when: install_check.rc != 0

- name: Ajouter une ligne de blacklist si absente
  lineinfile:
    path: "{{ mod_conf_file }}"
    line: "blacklist {{ mod_name }}"
    create: true
  when: blacklist_check.rc != 0

- name: Afficher le r√©sultat de la rem√©diation
  debug:
    msg: "üõ°Ô∏è Le module {{ mod_name }} a √©t√© d√©charg√©, rendu non chargeable et blacklist√©."
